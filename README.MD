# ETL —  Extract, Transform, Load.

## Урок 1. Модели данных и нормализация таблиц. Схема «звезда»

1. Условия ДЗ написаны на слайде 44 s1.pdf. Если не получиться, то просто запустите скрипт s1.scala, скоректируйте пути. В рамках первого семинара вы установили инструментарий ETL.
2. Нарисуйте архитектуру ETL процесса для сбора и анализа данных компанией которая хочет провести маркетинговую кампанию, используя app.diagrams.net. Сделайте описание почему вы считаете что архитектура должна выглядеть именно так.
3. Постройте реляционную и иерархическую модели данных для магазина который продает телефоны.
4. Определите в какой нормальной форме данная таблица, приведите ее ко 2 и 3 нормальным формам последовательно.
Нужно в apache spark создать таблицу  сданными ниже. Можно импортировать из Excel либо с генерировать ее кодом.

Сделать нормализацию по образцу 
(например, как здесь https://ru.wikipedia.org/wiki/%D0%92%D1%82%D0%BE%D1%80%D0%B0%D1%8F_%D0%BD%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%84%D0%BE%D1%80%D0%BC%D0%B0)
 
Сохранить полученный результат в БД. На проверку соберите код, скриншоты отработки консоли спарка и полученный результат в БД в один pdf файл.

Employee_ID    Name       Job_Code    Job         City_code   Home_city
E001           Alice      J01         Chef        26          Moscow
E001           Alice      J02         Waiter      26          Moscow
E002           Bob        J02         Waiter      56          Perm
E002           Bob        J03         Bartender   56          Perm
E003           Alice      J01         Chef        56          Perm

## Урок 2. Введение в подготовку данных для аналитиков. Таблицы фактов и таблицы измерений

1. Скачайте датасет fifаs2.сsv. Проанализируйте его и определите, какие данные являются неполными. Удалите
ненужные колонки и недостающие значения.

2. Найдите в датафрейме полные дубликаты и удалите их. Значения могут быть одинаковыми, но написаны по-разному. Например, может отличаться размер регистра (заглавные и строчные буквы). Особое внимание уделить колонке с названиями команд.

3. Напишите функцию, которая добавит колонку с разбиением возраста по группам: до 20, от 20 до 30, от 30 до
36 и старше 36. Посчитайте количество футболистов в каждой категории.
ЗАДАНИЕ НУЖНО СДЕЛАТЬ С ПОМОЧЬЮ APACHE SPARK КАК ПОКАЗАНО НА СЕМИНАРЕ. 
Соберите все в один pdf, код и скриншоты записанных таблиц с данными, скриншоты отработки лога спарка.

## Урок 3. Получение денормализованных таблиц из нормализованных

1. Денормализуйте таблицу так, чтобы не нужно было для каждого рекламодателя постоянно подсчитывать количество кампаний и продаж.

2. В базе данных есть две таблицы: страны и клиенты. Одной из потребностей компании является исследование клиентов и стран с точки зрения эффективности продаж, поэтому часто выполняются объединения между таблицами: клиенты и страны. Что нужно сделать, чтобы ограничить частое объединение этих двух таблиц?

3. Вернемся к первому примеру. Предположим, компания хочет регулярно извлекать данные о продажах, например, о кампаниях или рекламодателях с полными именами. Как мы можем решить проблему постоянной необходимости объединения таблиц?

4. Из задания которое разбирали на семинаре взять запрос и использовать его в скаловском скрипте, через спарк создать вторую таблицу. 
И сделать через GROUP_CONCAT список как на семинаре, Сделайте формат времени 11.01.23 22.29 (без секунд) и через case сократите названия статусов 
(Например, Зарегистрирован З, Закрыт --> ЗТ).

5.  Всю туже саму логику запроса перенести на спарк.

## Урок 4. Партицирование данных по дате. Динамическое партицирование

1. За основу возьмите Задание 4 решенное на семинаре.
В файле s4_2 параметры кредита: Займ 9400000, срок 30 лет, ставка 10.6%.
Через https://calcus.ru/kreditnyj-kalkulyator-s-dosrochnym-pogasheniem добавьте два листа в Excel с постоянным платежом 120 или 150 тыс. руб.
(Необязательно, но можете также сделать и для платежа 250 и 300).
Добавьте графики с досрочным погашением по этим пирометрам. Т.е. линии по выплатам основного долга и процентов если платеж будет 120 или 150 тыс. руб. В результате должно получиться 6 линий. Используйте разные цвета.

### Урок 5. Обзор возможностей Airflow, установка и настройка

1. Установите AirFlow как показано на семинаре, соберите список команд установки, скриншоты GUI и работы аирфлоу из мобы. Соберите все данные в один pdf файл.
2. Проверить гипотезу будет ли достаточно установки sudo apt install -y python3 python3-pip python3-venv без sudo apt install python3.8 
3. Создайте мануал со списком команд для установки.
